# Установка, развертывание и запуск — вопросы

## 1 Ошибка при установке MaxKB: docker-compose--X.XX.X не может запустить/доступиться к сервисам

!!! Abstract ""
    Возможная причина — устаревшая версия Docker. Рекомендуется использовать Docker из установочного пакета. В пакете: Docker 27.2.0, Compose v2.29.2.

## 2 Как предоставить внешний доступ к встроенному pgsql через порт хоста?

!!! Abstract ""
    По умолчанию, в целях безопасности, контейнер pgsql слушает 5432 только на хосте; с других адресов доступ закрыт.

![Правило доступа по умолчанию](../../img/FAQ/lcoal_pgsql.png)

!!! Abstract ""
    Чтобы открыть доступ с других серверов, настройте параметры в `/opt/maxkb/.env` и выполните `mkctl reload`.

![Пример конфигурации](../../img/FAQ/expose_pgsql_config.png)

![Открытие порта](../../img/FAQ/expose_pgsql.png)


## 3 При обновлении: ModuleNotFoundError: No module named 'XXX'

!!! Abstract ""
    Некоторые старые зависимости несовместимы с новой версией и мешают запуску. Перейдите в каталог зависимостей:
    Выполните:
    ```
    cd /opt/maxkb/python-packages
    ```
    Найдите пакет, вызывающий конфликт (по логам ошибок), удалите его и перезапустите сервис `mkctl restart`.

## 4 PostgreSQL: ошибка too many clients already (превышен лимит подключений)

!!! Abstract ""
    Это означает, что достигнут предел подключений. Увеличьте лимит в конфигурации PostgreSQL. Перейдите в каталог конфигурации:
    ```
    cd /opt/maxkb/data/postgresql/pgdata/
    ```
    В файле postgresql.conf найдите параметр max_connections и задайте нужное значение. Например, 200
    ```
    max_connections = 200
    ```
    Остановите работающий сервис MaxKB и удалите контейнер PostgreSQL:
    ```
    docker stop maxkb

    docker rm maxkb
    ```
    Выполните `mkctl reload`, чтобы перезагрузить конфигурацию и запустить сервис.
